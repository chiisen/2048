# 2048 遊戲 PRD (產品需求文檔)

## 1. 專案概述

- **專案名稱**：2048 網頁版遊戲
- **類型**：休閒益智遊戲
- **核心玩法**：經典 2048 數字合併遊戲
- **目標用戶**：休閒遊戲玩家

## 2. 當前問題清單

### 🔴 嚴重問題

| # | 問題描述 | 優先級 |
|---|----------|--------|
| 1 | 遊戲操作不正常，移動後方塊行為異常 | P0 |
| 2 | 顯示 0 的問題（之前回報過但可能未完全修復） | P0 |
| 3 | 移動動畫缺失，方塊直接消失並重新出現 | P0 |

### 🟠 功能缺失

| # | 問題描述 | 優先級 |
|---|----------|--------|
| 4 | 最高分記錄功能（best score） | P1 |
| 5 | 移動動畫（tile 滑動效果） | P0 |
| 6 | 合併動畫（pop 效果） | P1 |
| 7 | 勝利條件達成時的慶祝畫面 | P2 |

## 3. 技術問題分析

### 3.1 移動邏輯問題

**現狀**：每次移動後清除所有 tiles 重新創建
```javascript
this.clearTiles();
for (let r = 0; r < this.size; r++) {
    for (let c = 0; c < this.size; c++) {
        if (this.grid[r][c] !== 0) {
            this.createTile(r, c, this.grid[r][c], false);
        }
    }
}
```

**問題**：這會導致無法實現平滑的移動動畫

**解決方案**：
1. 追蹤每個 tile 的唯一 ID
2. 移動時保留現有 tile，僅更新位置
3. 合併時刪除被合併的 tile，更新目標 tile 的數值
4. 新產生的 tile 使用動畫

### 3.2 合併檢測邏輯

**現狀**：
```javascript
merged[direction === 'left' || direction === 'right' ? i : j]
      [direction === 'up' || direction === 'down' ? i : j] = true;
```

**問題**：索引計算在上下左右四個方向可能不正確

## 4. 功能需求

### 4.1 核心功能

- [ ] 4x4 網格遊戲
- [ ] 方向鍵控制 (↑↓←→)
- [ ] 觸控滑動支援
- [ ] 分數計算
- [ ] 遊戲結束偵測
- [ ] 重新開始功能

### 4.2 動畫需求

- [ ] 方塊移動動畫 (slide)
- [ ] 方塊合併動畫 (pop)
- [ ] 新方塊出現動畫 (appear)
- [ ] 合併成功灑花效果 (canvas-confetti)

### 4.3 UI/UX 需求

- [ ] 方向鍵視覺提示
- [ ] 當前分數顯示
- [ ] 最高分記錄 (localStorage)
- [ ] 遊戲結束遮罩
- [ ] 響應式設計

## 5. 驗收標準

### 功能驗收

- [ ] 按方向鍵可正確移動所有方塊
- [ ] 相同數字合併後變為兩倍
- [ ] 每次移動後隨機生成新方塊 (2 或 4)
- [ ] 遊戲結束時顯示遊戲結束畫面
- [ ] 可點擊重新開始

### 動畫驗收

- [ ] 方塊移動時有平滑的滑動效果
- [ ] 合併時有縮放彈跳效果
- [ ] 新方塊出現時有淡入放大效果

### 視覺驗收

- [ ] 不同數字有不同顏色
- [ ] 方向鍵提示清晰可見
- [ ] 行動裝置可正常操作

## 6. 技術架構

```
2048/
├── index.html   # HTML 結構
├── style.css    # 樣式 (CSS Variables, Animations)
├── game.js      # 遊戲邏輯
└── README.md    # 說明文件
```

### 外部依賴

- **canvas-confetti**: 灑花效果
- **Fredoka** (Google Fonts): 字體

## 7. 待處理任務

1. 修復移動邏輯，實現真正的滑動動畫
2. 修復合併檢測邏輯
3. 添加最高分功能
4. 添加勝利畫面（達到 2048）
5. 測試並驗證所有功能
